"""Test vectorized conversion functions.

:author: Shay Hill
:created: 2024-08-22
"""

# pyright: reportPrivateUsage=false

<<<<<<< HEAD
import numpy as np

from basic_colormath.conversion import rgb_to_hex, rgb_to_hsl, rgb_to_hsv
from basic_colormath.vec_conversion import (
    _get_hues_from_rgbs,
    hexs_to_rgbs,
    hsls_to_rgbs,
    hsvs_to_rgbs,
    rgbs_to_hexs,
    rgbs_to_hsls,
    rgbs_to_hsvs,
)

=======
from basic_colormath.vec_conversion import _get_hues_from_rgbs
import numpy as np

>>>>>>> a6f1b30 (feat: vectorized rgbs_to_hsls)

class TestGetHuesFromRgbs:
    def test_explicit(self):
        rgbs = np.array(
            [
                [0, 0, 0],
                [255, 0, 0],
                [255, 255, 0],
                [0, 255, 0],
                [0, 255, 255],
                [0, 0, 255],
                [255, 0, 255],
                [255, 255, 255],
            ],
            dtype=np.uint8,
        )
        # set mins as the minimum value for each of the rgb channels
        mins = np.min(rgbs, axis=-1)
        maxs = np.max(rgbs, axis=-1)
        hues = _get_hues_from_rgbs(rgbs, mins, maxs)
        np.testing.assert_array_almost_equal([0, 0, 60, 120, 180, 240, 300, 0], hues)
<<<<<<< HEAD


class TestRgbsToHsvs:
    def test_match_single(self):
        """Match result of single conversion mapped over array."""
        rgbs = np.random.randint(0, 256, (10, 11, 12, 3), dtype=np.uint8)
        hsvs = rgbs_to_hsvs(rgbs)
        for ixs in np.ndindex(rgbs.shape[:-1]):
            r, g, b = map(int, rgbs[ixs])
            hsv = rgb_to_hsv((r, g, b))
            np.testing.assert_array_almost_equal(hsvs[ixs], hsv)


class TestHscsToRgbs:
    def test_roflection(self):
        """rgb to hsv to rgb to hsv

        hsv to rgb to hsv will not always be the same, because hue information is
        lost when saturation or value are zero.
        """
        rgbs_a = np.random.randint(0, 256, (10, 11, 12, 3), dtype=np.uint8)
        hsvs_a = rgbs_to_hsvs(rgbs_a)
        rgbs_b = hsvs_to_rgbs(hsvs_a)
        hsvs_b = rgbs_to_hsvs(rgbs_b)
        np.testing.assert_array_almost_equal(hsvs_a, hsvs_b)


class TestRgbsToHsls:
    def test_match_single(self):
        """Match result of single conversion mapped over array."""
        rgbs = np.random.randint(0, 256, (10, 11, 12, 3), dtype=np.uint8)
        hsls = rgbs_to_hsls(rgbs)
        for ixs in np.ndindex(rgbs.shape[:-1]):
            r, g, b = map(int, rgbs[ixs])
            hsl = rgb_to_hsl((r, g, b))
            np.testing.assert_array_almost_equal(hsls[ixs], hsl)


class TestHslsToRgbs:
    def test_reflection(self):
        """rgb to hsl to rgb to hsl

        hsl to rgb to hsl will not always be the same, because hue information is
        lost when saturation or lightness are zero.
        """
        rgbs_a = np.random.randint(0, 256, (10, 11, 12, 3), dtype=np.uint8)
        hsls_a = rgbs_to_hsls(rgbs_a)
        rgbs_b = hsls_to_rgbs(hsls_a)
        hsls_b = rgbs_to_hsls(rgbs_b)
        np.testing.assert_array_almost_equal(hsls_a, hsls_b)


class TestRgbsToHexs:
    def test_match_single(self):
        """Match result of single conversion mapped over array."""
        rgbs = np.random.randint(0, 256, (10, 11, 12, 3), dtype=np.uint8)
        hexs = rgbs_to_hexs(rgbs)
        for ixs in np.ndindex(rgbs.shape[:-1]):
            r, g, b = map(int, rgbs[ixs])
            hex_ = rgb_to_hex((r, g, b))
            assert hexs[ixs] == hex_


class TestHexsToRgbs:
    def test_reflection(self):
        """rgb to hex to rgb

        hex to rgb to hex will always be the same.
        """
        rgbs_a = np.random.randint(0, 256, (10, 11, 12, 3), dtype=np.uint8)
        hexs_a = rgbs_to_hexs(rgbs_a)
        rgbs_b = hexs_to_rgbs(hexs_a)
        hexs_b = rgbs_to_hexs(rgbs_b)
        np.testing.assert_array_equal(hexs_a, hexs_b)
=======
>>>>>>> a6f1b30 (feat: vectorized rgbs_to_hsls)
